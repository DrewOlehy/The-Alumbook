<div class="row">
  <div class="large-12 large-centered medium-12 small-12 columns">
    <div id="displayResults" style="overflow: auto; height: 100%; width: 100%;">
      <table>
          <tr>
            <% @results.try(:first).try(:attributes).try(:except, *@keys_blacklist).try(:each) do |attr_name, attr_value| %>
                <% if attr_name != 'id' %>
                  <td><%= attr_name.humanize %></td>
                <% end %>
            <% end %>
            <% @results.try(:first).try(:user).try(:attributes).try(:except, *@user_blacklist).try(:each) do |attr_name, attr_value| %>
              <td><%= attr_name.humanize %></td>
            <% end %>
            <% @results.try(:first).try(:user).try(:user_phones).try(:first).try(:attributes).try(:each) do |attr_name, attr_value| %>
              <td><%= attr_name.humanize %></td>
            <% end %>
            <% @results.try(:first).try(:user).try(:undergraduate_degrees).try(:first).try(:attributes).try(:each) do |attr_name, attr_value| %>
              <td><%= attr_name.humanize %></td>
            <% end %>
            <% @results.try(:first).try(:user).try(:graduate_degrees).try(:first).try(:attributes).try(:each) do |attr_name, attr_value| %>
              <td><%= attr_name %>
            <% end %>
          </tr>

        <% @results.try(:each) do |result| %>
          <% result.user.try(:undergraduate_degrees).try(:each) do |undergrad| %>
            <% result.user.try(:graduate_degrees).try(:each) do |grad_degree| %>
              <tr>
                <% result.attributes.except(*@keys_blacklist).each do |attr_name, attr_value| %>
                  <% if attr_name == 'id' %>
                    <% @login_id = attr_value %>
                  <% elsif attr_name == 'username' %>
                    <td><%= link_to attr_value, user_information_path(@login_id), style: "color: #0000AA;" %></td>
                  <% else %>
                    <td><%= attr_value %></td>
                  <% end %>
                <% end %>

                <!-- Print user information -->
                <% result.user.try(:attributes).try(:except, *@user_blacklist).try(:each) do |attr_name, attr_value| %>
                  <td><%= attr_value %></td>
                <% end %>

                <!-- Print first user phone -->
                <% result.user.try(:user_phones).try(:first).try(:attributes).try(:each) do |attr_name, attr_value| %>
                  <td><%= attr_value %></td>
                <% end %>
                
                <!-- Print user undergraduate degrees -->
                <% undergrad.try(:attributes).try(:each) do |attr_name, attr_value| %>
                  <td><%= attr_value %></td>
                <% end %>

                <!-- Print user graduate degrees -->
                <% grad_degree.try(:attributes).try(:each) do |attr_name, attr_value| %>
                  <td><%= attr_value %></td>
                <% end %>
              </tr>
            <% end %>
          <% end %>
        <% end %>
      </table>
    </div>
  </div>
</div>
